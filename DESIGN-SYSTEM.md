# みやび Design System — Telegram Safe

## 原則
1. **左揃え**のみ。スペース揃え禁止。
2. **絵文字**が構造を担う。罫線ボックス禁止。
3. **`——————————————`** で区切り（emダッシュ14個）。
4. **`↳`** で階層表現。
5. **Unicode太字**でセクション名・エージェント名。
6. **スモールキャップス**でフッター。
7. **リアクション**でフェーズを一目で識別。

## 4層UXモデル

Mission Controlは4つの層で情報を伝達する:

| 層 | 要素 | 情報密度 | 確認速度 |
|----|------|---------|---------|
| Layer 0 | 📌 ピン止め | 最小（存在のみ） | チャットを開いた瞬間 |
| Layer 1 | リアクション絵文字 | 最小（状態のみ） | チャット一覧で即座 |
| Layer 2 | メッセージ本文 | 中（進捗・エージェント状態） | メッセージを開いて数秒 |
| Layer 3 | インラインボタン | アクション | 承認・操作 |

### Layer 0: ピン止め（ミッション存在の告知）
```
📌 稼働中 → ピン止め表示（チャット上部）
✅ 完了/中止 → ピン解除
```
ピン止め = 「今ミッションが動いてる」という最速の視覚シグナル。

### Layer 1: リアクション（一目で状態判別）
```
🔥 稼働中 → 👀 承認待ち → 🎉 完了
                         → ❌ エラー
```

### Layer 2: メッセージ本文（詳細情報）
Phase 1-5のテンプレートに準拠（SKILL.md参照）

### Layer 3: インラインボタン（アクション）
Phase 4（承認ゲート）とPhase ERROR時に表示

## コンポーネント

### ヘッダー
```
{emoji} 𝗧𝗜𝗧𝗟𝗘 𝗧𝗘𝗫𝗧
```
例: `🤖 𝗠𝗜𝗦𝗦𝗜𝗢𝗡 𝗖𝗢𝗡𝗧𝗥𝗢𝗟`
完了時: `🤖 𝗠𝗜𝗦𝗦𝗜𝗢𝗡 𝗖𝗢𝗠𝗣𝗟𝗘𝗧𝗘 ✅`

### メタ情報
```
📋 {description}
⏱ {elapsed} ∣ 💰 ${cost}
```

### 区切り線
```
——————————————
```

### セクションタイトル
```
↳ {emoji} 𝗦𝗘𝗖𝗧𝗜𝗢𝗡 𝗡𝗔𝗠𝗘
```
例: `↳ 🧩 𝗔𝗚𝗘𝗡𝗧𝗦 (2/3 complete)`

### エージェントブロック（稼働中）
```
🔥 {agent_name} ∣ {task}
▓▓▓▓▓▓▓▓░░░░░░░░ 50%
🧠 {thinking/interim_result}
⏱ {time} ∣ 💰 ${cost}
```

### エージェントブロック（完了 — 展開時）
```
✅ {agent_name} ∣ {task}
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ 100%
🧠 {result_summary}
📄 Output: {filename} ({size})
⏱ {time} ∣ 💰 ${cost}
```

### エージェントブロック（完了 — 折り畳み時）
```
✅ {agent_name} ∣ {task}
📄 {filename} ∣ ⏱ {time} ∣ 💰 ${cost}
```

### プログレスバー
```
▓▓▓▓▓▓▓▓░░░░░░░░ 50%
```
16セグメント固定。`filled = round(percent / 100 * 16)`

### 承認ゲートブロック
```
——————————————
⏸️ 𝗔𝗪𝗔𝗜𝗧𝗜𝗡𝗚 𝗔𝗣𝗣𝗥𝗢𝗩𝗔𝗟
{question}
——————————————
```

### 成果物リスト
```
↳ 📄 𝗗𝗘𝗟𝗜𝗩𝗘𝗥𝗔𝗕𝗟𝗘𝗦
——————————————
📄 {file_1} — {description}
📄 {file_2} — {description}
```

### インサイトリスト
```
↳ 💡 𝗞𝗘𝗬 𝗜𝗡𝗦𝗜𝗚𝗛𝗧𝗦
——————————————
1. {insight_1}
2. {insight_2}
3. {insight_3}
```

### 承認記録
```
↳ ✅ 𝗔𝗣𝗣𝗥𝗢𝗩𝗘𝗗
——————————————
承認者: {approver} ∣ {timestamp}
アクション: {action}
```

### フッター
```
——————————————
🌸 ᴘᴏᴡᴇʀᴇᴅ ʙʏ ᴍɪʏᴀʙɪ
```

## ステータスアイコン

| 用途 | アイコン |
|------|---------|
| 初期化 | ⏳ |
| 実行中 | 🔥 |
| 書込中 | ✏️ |
| 待機中 | ⏸️ |
| 完了 | ✅ |
| エラー | ❌ |
| リトライ | 🔄 |
| 警告 | ⚠️ |
| 承認待ち | ⏸️ |

## カテゴリアイコン

| 用途 | アイコン |
|------|---------|
| ミッション | 📋 |
| ゴール | 🎯 |
| 検索 | 🔍 |
| データ | 📊 |
| 執筆 | 📝 |
| レビュー | ✅ |
| ファイル | 📁 |
| ドキュメント | 📄 |
| ヒント/中間結果 | 💡 |
| 依存関係 | 🔗 |
| コスト | ⚡ |
| 時間 | ⏱ |
| エージェント | 🤖 |
| みやび | 🌸 |
| 思考 | 🧠 |
| パーツ | 🧩 |

## インラインボタン定義

### 承認ゲート（Phase 4）
```json
[
  [
    {"text": "✅ 承認", "callback_data": "mc:approve"},
    {"text": "👁 プレビュー", "callback_data": "mc:preview"}
  ],
  [
    {"text": "✏️ 修正指示", "callback_data": "mc:revise"},
    {"text": "❌ 中止", "callback_data": "mc:abort"}
  ]
]
```

### エラーリカバリ（Phase ERROR）
```json
[
  [
    {"text": "🔄 リトライ", "callback_data": "mc:retry"},
    {"text": "⏭ スキップ", "callback_data": "mc:skip"}
  ],
  [
    {"text": "📄 部分結果で完了", "callback_data": "mc:partial_complete"},
    {"text": "❌ 中止", "callback_data": "mc:abort"}
  ]
]
```

## チャンネル投稿タイプ別アイコン

| タイプ | アイコン |
|--------|---------|
| おはよう | 🌅 |
| AI Today | 🧠 |
| プロジェクト | 📊 |
| まとめ | 🌙 |
| KAEDE | 🔬 |
| 速報 | 🚨 |
| お知らせ | 📢 |
| 起動通知 | 🌸 |

## DM × チャンネル連動モデル

```
DM（オペレーター）          チャンネル（ログ）
┌─────────────────┐     ┌──────────────────┐
│📌 マスターチケット │     │                  │
│  (常駐ピン)       │     │                  │
├─────────────────┤     │                  │
│📌 Mission #1 🔥  │ ──→ │🚀 Mission Started│
│  (一時ピン)       │     │                  │
│  edit更新中...    │     │  (進捗は非公開)   │
│  📌→アンピン      │ ──→ │✅ Mission Done   │
└─────────────────┘     └──────────────────┘
```

- DM: 全情報（4層UX）
- チャンネル: 開始 + 完了のみ（ノイズ最小）
- コスト等の内部情報はチャンネルには出さない

## 取り消し線（完了タスクの消し込み）

Telegramの `~テキスト~` で取り消し線が使える。
完了済みタスクに適用し、「終わった感」を視覚的に強調。

```
✅ ~1.0 設計フェーズ~
  ~1.1 デザインシステム確定~
  ~1.2 全6フェーズテンプレート~
```

- 完了フェーズ: `✅ ~{phase_name}~`
- 完了タスク: `~{wbs_number} {task_name}~`
- 未完了: 取り消し線なし

## WBS型マスターチケット構造

```
🎯 ゴール（最上位）
📊 プログレスバー

✅ ~1.0 完了フェーズ~ ← 消し込み
  ~1.1 完了タスク~

👉 2.0 現在フェーズ ← 𝗜𝗠𝗔 𝗞𝗢𝗞𝗢
  ⏸️ 2.1 次のタスク

⬜ 3.0 未着手フェーズ
  ⬜ 3.1 未着手タスク
```

状態アイコン:
- ✅ 完了（+ 取り消し線）
- 👉 現在進行中（← 𝗜𝗠𝗔 𝗞𝗢𝗞𝗢）
- ⏸️ 次の待ち
- ⬜ 未着手

## 禁止事項
- `┏┗┓┛━┃` 罫線文字 → 崩れる
- スペースによる位置揃え → プロポーショナルフォントで崩れる
- `<b>` `<i>` HTMLタグ → Telegram Bot APIはMarkdown/HTMLモード依存
- 長い1行（60文字超） → 折り返しが予測不能
- 同一メッセージへの連続edit（1秒間隔未満） → Telegram API rate limit
